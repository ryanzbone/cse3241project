-- Part C INSERT syntax

-- Books can be inserted directly
INSERT INTO Book
            (isbn,
             price,
             title,
             pid,
             year,
             length)
VALUES      (0316066525,
             19.99,
             'Infinite Jest',
             142,
             1996,
             1079);

-- Publisher requires name, entity, publisher records
INSERT INTO Names
(fname,
             mname,
             lname)
VALUES      ('OSU UniPrint',
             '',
             '');

INSERT INTO entity
            (email,
             phone,
             country,
             city,
             state,
             postalcode,
             address,
             nameid)
SELECT 'uniprint@osu.edu',
       '6142922219',
       'United States',
       'Columbus',
       'OH',
       '43201',
       '1739 N. High Street',
       id
FROM   names
WHERE  fname = 'OSU UniPrint';

INSERT INTO publisher
            (eid,
             slogan)
SELECT e.id           AS eid,
       'Go Buckeyes!' AS slogan
FROM   entity e,
       names n
WHERE  e.nameid = n.id
  AND  n.fname = 'OSU UniPrint';

-- Author requires name, entity entries
INSERT INTO Names
            (fname,
             mname,
             lname)
VALUES      ('David',
             'Foster',
             'Wallace');

INSERT INTO entity
            (nameid)
SELECT id
FROM   names
WHERE  fname = 'David'
       AND mname = 'Foster'
       AND lname = 'Wallace';

-- Associate book with author
INSERT INTO bookauthor
            (isbn,
             nameid)
SELECT 9780316074230,
       id
FROM   names
WHERE  fname = 'David'
       AND mname = 'Foster'
       AND lname = 'Wallace';

-- Customer requires name, entity, customer entries
INSERT INTO Names
(fname,
            mname,
            lname)
VALUES      ('Bob',
            '',
            'Smith');
-- Then, the entity relationship is changed with the new name:
INSERT INTO Entity
           (nameid)
SELECT id
FROM   names
WHERE  fname = 'Bob'
      AND mname = ''
      AND lname = 'Smith';

-- Lastly, the Customer table gets a reference to the new entity:
INSERT INTO Customer
           (eid)
SELECT E.id
FROM   Names N, Entity E
WHERE  E.nameid = N.id
    AND fname = 'Bob'
    AND mname = ''
    AND lname = 'Smith';


-- Part D
-- Book: Deleting a book requires first pruning its authors, categories, descriptions, and ratings:
DELETE FROM BookAuthor
WHERE   isbn = '112233445566';

DELETE FROM BookCategory
WHERE   isbn = '112233445566';

DELETE FROM BookDescription
WHERE   isbn = '112233445566';

DELETE FROM Rating
WHERE   bid = '112233445566';

-- Next, it is removed from inventory:
DELETE FROM Inventory
WHERE   bid = '112233445566';

-- And last, the original record from Book is destroyed:
DELETE FROM Book
WHERE   isbn = '112233445566';

-- Deleting an author first requires removing the links to books they’ve written:
DELETE FROM bookauthor
WHERE  bookauthor.nameid IN (SELECT n.id
                             FROM   names n
                             WHERE  n.fname = 'David'
                                AND n.lname = 'Wallace');

-- Deleting a publisher requires removing the books they’ve published:

DELETE FROM book
WHERE  book.pid IN (SELECT p.eid
                    FROM   publisher p
                    WHERE p.eid IN (SELECT e.nameid
                                             FROM   entity e
                                             WHERE  e.nameid IN (SELECT n.fname
                                                                 FROM   names n
                                                                 WHERE  fname =
                                                                'OSU UniPrint')));

-- The publisher is then removed from the publisher table:

DELETE FROM publisher
WHERE  publisher.eid IN (SELECT e.nameid
                         FROM   entity e
                         WHERE  e.nameid IN (SELECT n.fname
                                             FROM   names n
                                             WHERE  fname = 'OSU UniPrint'));

-- The publisher is then removed from the entity table:

DELETE FROM entity
WHERE  entity.nameid IN (SELECT n.fname
                    FROM   names n
                    WHERE  fname = 'OSU UniPrint');

-- And lastly, from the name table:
DELETE FROM names
WHERE  ( fname = 'OSU UniPrint' );

-- Customer
-- Given a customer id, first delete from customer table:

DELETE FROM customer
WHERE  eid = 140;

-- Then find nameid from entity table:

SELECT nameid
FROM   entity
WHERE  id = 140;

-- Next delete from entity table:

DELETE FROM entity
WHERE  id = 140;

-- Finally delete from names table with previously found name id:

DELETE FROM names
WHERE  id = 140;

-- Warehouse
-- Given a warehouse id, first delete from inventory:

DELETE FROM inventory
WHERE  wid = 204;

-- Next delete any employees working at that warehouse:

DELETE FROM employee
WHERE  wid = 204;

-- Next find the name id from the warehouse/entity id:

SELECT nameid
FROM   entity
WHERE  id = 204;

-- Finally delete the warehouse, entity and name entry:

DELETE FROM warehouse
WHERE  id = 204;

DELETE FROM entity
WHERE  id = 204;

DELETE FROM names
WHERE  id = 204;
